{{ template "course_settings_popups.html" . }}

<script>
    document.addEventListener("alpine:init", function(event) {
        Alpine.store("settings", {
            open: false,
            title: "{{ .Course.Title }}",
            name: "{{ .Course.Name }}",
            subtitle: "{{ .Course.Subtitle }}",
            public: {{ .Course.Public }},

            startTitle: "{{ .Course.Title }}",
            startName: "{{ .Course.Name }}",
            startSubtitle: "{{ .Course.Subtitle }}",
            startPublic: {{ .Course.Public }},
        })
    });

    function settings_save() {
        let courseID = Alpine.store("course").courseID;

        let formData = new FormData();
        formData.append("title", Alpine.store("settings").title);
        formData.append("name", Alpine.store("settings").name);
        formData.append("subtitle", Alpine.store("settings").subtitle);
        formData.append("public", Alpine.store("settings").public);

        postFetch2("/v2/course/"+courseID, formData, function(json) {
            if (json.Error !== "") {
                return;
            }

            // reload page since url of course may change
            // also we don't need to update the course title and name since we reloaded
            window.location.href = "/" + json.Payload.User.Username + "/" + json.Payload.Name;
         });
    }

    function settings_open() {
        Alpine.store("settings").open = true;
    }

    function settings_close() {
        Alpine.store("settings").open = false;
    }
</script>

<div x-data x-transition x-show="$store.settings.open === true" class="thm-overlay" style="z-index:4; position:fixed; top:0; left:0; right:0; bottom:0;">
    <div style="display:flex; flex-direction:column; height:100vh; padding:1rem; overflow-y: scroll;">
        <div style="display:flex; flex-direction:row;">
            <i style="margin-left:auto; padding:1rem;" @click="settings_close()" class="fa-solid fa-xmark"></i>
        </div>
        <div>
            <div class="thm-c-less" style="font-weight:600; font-size:0.8rem; padding:0.2rem;">COURSE TITLE</div>
            <input x-model="$store.settings.title" class="utls-bd thm-bg" placeholder="Title" style="color:white;"></input>
        </div>
        
        <div style="margin-top:2rem;">
            <div class="thm-c-less" style="font-weight:600; font-size:0.8rem; padding:0.1rem;">COURSE URL NAME</div>
            <input x-model="$store.settings.name" placeholder="Name" class="thm-bg utls-bd utls-bd-none">
        </div>
        
        <div style="margin-top:2rem;">
            <div class="thm-c-less" style="font-weight:600; font-size:0.8rem; padding:0.2rem;">COURSE DESCRIPTION</div>
            <textarea x-model="$store.settings.subtitle" class="thm-bg utls-bd utls-bd-none" placeholder="Tell people what your course is about" style="color:white; max-width:100%; min-width:100%; padding:0.5rem; max-height:5rem; min-height:5rem;">{{ .Course.Subtitle }}</textarea>
        </div>

        <div style="margin-top:2rem;">
            <div class="thm-c-less" style="font-weight:600; font-size:0.8rem; padding:0.2rem;">PUBLIC</div>
            <div style="margin-bottom: 2rem;">
                <input
                x-model="$store.settings.public" 
                class="utls-bd-none" 
                type="checkbox"
                name="public"
                style="height:16px; width:16px;">
            </div>
        </div>

        <div style="margin-top:auto;">
            <button
            @click="settings_save()"
            x-transition
            x-show="
            $store.settings.public !== $store.settings.startPublic || 
            $store.settings.title !== $store.settings.startTitle || 
            $store.settings.name !== $store.settings.startName || 
            $store.settings.subtitle !== $store.settings.startSubtitle"
            class="utls-bd thm-bg-hl" 
            style="color:white; width:100%; padding:1rem; text-align: center; font-weight:500;">
            Save</button>
        </div>
    </div>
</div>